{"version":3,"file":"debug.js","sourceRoot":"","sources":["../../../../../../packages/core/src/render3/debug.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {Injector} from '../di/injector';\nimport {Renderer2, RendererType2} from '../render/api';\nimport {DebugContext} from '../view';\nimport {DebugRenderer2, DebugRendererFactory2} from '../view/services';\n\nimport * as di from './di';\nimport {NG_HOST_SYMBOL, _getViewData} from './instructions';\nimport {LElementNode} from './interfaces/node';\nimport {CONTEXT, DIRECTIVES, LViewData, TVIEW} from './interfaces/view';\n\n/**\n * Adapts the DebugRendererFactory2 to create a DebugRenderer2 specific for IVY.\n *\n * The created DebugRenderer know how to create a Debug Context specific to IVY.\n */\nexport class Render3DebugRendererFactory2 extends DebugRendererFactory2 {\n  createRenderer(element: any, renderData: RendererType2|null): Renderer2 {\n    const renderer = super.createRenderer(element, renderData) as DebugRenderer2;\n    renderer.debugContextFactory = () => new Render3DebugContext(_getViewData());\n    return renderer;\n  }\n}\n\n/**\n * Stores context information about view nodes.\n *\n * Used in tests to retrieve information those nodes.\n */\nclass Render3DebugContext implements DebugContext {\n  readonly nodeIndex: number|null;\n\n  constructor(private viewData: LViewData) {\n    // The LNode will be created next and appended to viewData\n    this.nodeIndex = viewData ? viewData.length : null;\n  }\n\n  get view(): any { return this.viewData; }\n\n  get injector(): Injector {\n    if (this.nodeIndex !== null) {\n      const lElementNode: LElementNode = this.view[this.nodeIndex];\n      const nodeInjector = lElementNode.nodeInjector;\n\n      if (nodeInjector) {\n        return new di.NodeInjector(nodeInjector);\n      }\n    }\n    return Injector.NULL;\n  }\n\n  get component(): any {\n    // TODO(vicb): why/when\n    if (this.nodeIndex === null) {\n      return null;\n    }\n\n    const tView = this.view[TVIEW];\n    const components: number[]|null = tView.components;\n\n    return (components && components.indexOf(this.nodeIndex) == -1) ?\n        null :\n        this.view[this.nodeIndex].data[CONTEXT];\n  }\n\n  // TODO(vicb): add view providers when supported\n  get providerTokens(): any[] {\n    const matchedDirectives: any[] = [];\n\n    // TODO(vicb): why/when\n    if (this.nodeIndex === null) {\n      return matchedDirectives;\n    }\n\n    const directives = this.view[DIRECTIVES];\n\n    if (directives) {\n      const currentNode = this.view[this.nodeIndex];\n      for (let dirIndex = 0; dirIndex < directives.length; dirIndex++) {\n        const directive = directives[dirIndex];\n        if (directive[NG_HOST_SYMBOL] === currentNode) {\n          matchedDirectives.push(directive.constructor);\n        }\n      }\n    }\n    return matchedDirectives;\n  }\n\n  get references(): {[key: string]: any} {\n    // TODO(vicb): implement retrieving references\n    throw new Error('Not implemented yet in ivy');\n  }\n\n  get context(): any {\n    if (this.nodeIndex === null) {\n      return null;\n    }\n    const lNode = this.view[this.nodeIndex];\n    return lNode.view[CONTEXT];\n  }\n\n  get componentRenderElement(): any { throw new Error('Not implemented in ivy'); }\n\n  get renderNode(): any { throw new Error('Not implemented in ivy'); }\n\n  // TODO(vicb): check previous implementation\n  logError(console: Console, ...values: any[]): void { console.error(...values); }\n}"]}